# ğŸš¨ Railway 502 ì˜¤ë¥˜ ì™„ì „ í•´ê²° ê°€ì´ë“œ

## ë¬¸ì œ
```
Application failed to respond
502 Bad Gateway
```

## ì›ì¸
ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ê±°ë‚˜ í¬ë˜ì‹œí–ˆìŠµë‹ˆë‹¤.

---

## âœ… ì¦‰ì‹œ í•´ê²° ë°©ë²• (5ë¶„)

### Step 1: ë°°í¬ ë¡œê·¸ í™•ì¸ (ê°€ì¥ ì¤‘ìš”!)

**Railway ëŒ€ì‹œë³´ë“œì—ì„œ:**
1. ì„œë¹„ìŠ¤ í´ë¦­
2. **Deployments** íƒ­
3. ìµœì‹  ë°°í¬ í´ë¦­
4. **View Logs** í´ë¦­

**í™•ì¸í•  ë‚´ìš©:**

#### âœ… ì •ìƒ ì‹œì‘ ë¡œê·¸:
```
INFO:     Started server process
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:XXXX
```

#### âŒ ì˜¤ë¥˜ ë¡œê·¸ ì˜ˆì‹œ:

**"could not connect to server"**
```
sqlalchemy.exc.OperationalError: could not connect to server
```
â†’ **í•´ê²°**: PostgreSQL í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€ ë° DATABASE_URL í™•ì¸

**"SECRET_KEY"**
```
pydantic_core._pydantic_core.ValidationError
```
â†’ **í•´ê²°**: SECRET_KEY í™˜ê²½ë³€ìˆ˜ ì„¤ì •

**"ModuleNotFoundError"**
```
ModuleNotFoundError: No module named 'app'
```
â†’ **í•´ê²°**: Root Directoryë¥¼ `backend`ë¡œ ì„¤ì •

**"Address already in use"**
```
Address already in use
```
â†’ **í•´ê²°**: Start Commandì—ì„œ `$PORT` ì‚¬ìš© í™•ì¸

---

### Step 2: í™˜ê²½ë³€ìˆ˜ í™•ì¸ (í•„ìˆ˜!)

**Settings â†’ Variables** íƒ­ì—ì„œ í™•ì¸:

#### í•„ìˆ˜ í™˜ê²½ë³€ìˆ˜:

```bash
# 1. DATABASE_URL (PostgreSQL í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€ ì‹œ ìë™ ìƒì„±)
DATABASE_URL=${{Postgres.DATABASE_URL}}

# ë˜ëŠ” ìˆ˜ë™ ì„¤ì •:
DATABASE_URL=postgresql://user:password@host:port/database
```

**PostgreSQL í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€:**
- í”„ë¡œì íŠ¸ ë·° â†’ "+ New" â†’ "Database" â†’ "Add PostgreSQL"
- ì¶”ê°€ í›„ `DATABASE_URL`ì´ ìë™ ìƒì„±ë¨

```bash
# 2. SECRET_KEY (ìˆ˜ë™ ìƒì„± í•„ìš”!)
SECRET_KEY=<ëœë¤-ë¬¸ìì—´-32ì-ì´ìƒ>
```

**SECRET_KEY ìƒì„±:**
```bash
python -c "import secrets; print(secrets.token_urlsafe(32))"
```

ë˜ëŠ” ì˜¨ë¼ì¸: https://randomkeygen.com/

```bash
# 3. ê¸°íƒ€ í™˜ê²½ë³€ìˆ˜
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=10080
CORS_ORIGINS=["*"]
```

---

### Step 3: Start Command í™•ì¸

**Settings â†’ Deploy** ì„¹ì…˜ì—ì„œ:

**âœ… ì˜¬ë°”ë¥¸ Start Command:**
```
uvicorn app.main:app --host 0.0.0.0 --port $PORT
```

**âŒ ì˜ëª»ëœ ì˜ˆì‹œ:**
```
uvicorn app.main:app --port 8080  # ê³ ì • í¬íŠ¸ ì‚¬ìš© ì•ˆ ë¨!
python app/main.py  # ì˜ëª»ëœ ëª…ë ¹ì–´
uvicorn main:app  # ì˜ëª»ëœ ê²½ë¡œ
```

---

### Step 4: Root Directory í™•ì¸

**Settings â†’ Service Settings** ì„¹ì…˜ì—ì„œ:

```
Root Directory: backend
```

âš ï¸ **ì´ê²Œ ì„¤ì •ë˜ì§€ ì•Šìœ¼ë©´ ëª¨ë“  ê²ƒì´ ì‹¤íŒ¨í•©ë‹ˆë‹¤!**

---

### Step 5: ì¬ë°°í¬

1. ëª¨ë“  ì„¤ì • í™•ì¸ í›„
2. **Deployments** íƒ­
3. **Redeploy** ë²„íŠ¼ í´ë¦­
4. ë¡œê·¸ ì‹¤ì‹œê°„ í™•ì¸

---

## ğŸ” ë‹¨ê³„ë³„ ì§„ë‹¨

### 1. ë¹Œë“œ ë‹¨ê³„ í™•ì¸

**ë¡œê·¸ì—ì„œ í™•ì¸:**
```
âœ“ Building
âœ“ Installing dependencies
âœ“ Build complete
```

**ì˜¤ë¥˜ê°€ ìˆë‹¤ë©´:**
- Root Directory í™•ì¸
- requirements.txt í™•ì¸

### 2. ì‹œì‘ ë‹¨ê³„ í™•ì¸

**ë¡œê·¸ì—ì„œ í™•ì¸:**
```
INFO:     Started server process
INFO:     Application startup complete.
```

**ì˜¤ë¥˜ê°€ ìˆë‹¤ë©´:**
- í™˜ê²½ë³€ìˆ˜ í™•ì¸ (DATABASE_URL, SECRET_KEY)
- Start Command í™•ì¸

### 3. ëŸ°íƒ€ì„ í™•ì¸

**ë¡œê·¸ì—ì„œ í™•ì¸:**
```
INFO:     Uvicorn running on http://0.0.0.0:XXXX
```

**ì˜¤ë¥˜ê°€ ìˆë‹¤ë©´:**
- í¬íŠ¸ ë°”ì¸ë”© í™•ì¸ ($PORT ì‚¬ìš©)
- ì• í”Œë¦¬ì¼€ì´ì…˜ í¬ë˜ì‹œ í™•ì¸

---

## ğŸ“‹ ì™„ì „í•œ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Railway Settings:
- [ ] **Root Directory**: `backend` ì„¤ì •ë¨
- [ ] **Start Command**: `uvicorn app.main:app --host 0.0.0.0 --port $PORT`
- [ ] **Python Version**: `3.11` (ë˜ëŠ” ìë™ ê°ì§€)

### í™˜ê²½ë³€ìˆ˜:
- [ ] **DATABASE_URL**: PostgreSQL í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€ë¨
- [ ] **SECRET_KEY**: ëœë¤ ë¬¸ìì—´ ì„¤ì •ë¨
- [ ] **ALGORITHM**: `HS256`
- [ ] **ACCESS_TOKEN_EXPIRE_MINUTES**: `10080`
- [ ] **CORS_ORIGINS**: `["*"]` ë˜ëŠ” Frontend URL

### PostgreSQL:
- [ ] PostgreSQL í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€ë¨
- [ ] DATABASE_URL ìë™ ìƒì„±ë¨

### ë°°í¬:
- [ ] ë¹Œë“œ ì„±ê³µ (ë¡œê·¸ í™•ì¸)
- [ ] ì‹œì‘ ì„±ê³µ (ë¡œê·¸ í™•ì¸)
- [ ] `/health` ì—”ë“œí¬ì¸íŠ¸ ì‘ë‹µ í™•ì¸

---

## ğŸ§ª ë°°í¬ í›„ í…ŒìŠ¤íŠ¸

### 1. Health Check
```bash
curl https://stockport-production.up.railway.app/health
```

**ì˜ˆìƒ ì‘ë‹µ:**
```json
{"status":"healthy"}
```

### 2. Root Endpoint
```bash
curl https://stockport-production.up.railway.app/
```

**ì˜ˆìƒ ì‘ë‹µ:**
```json
{
  "message": "Portfolio Manager API",
  "version": "1.0.0",
  "status": "running"
}
```

### 3. API ë¬¸ì„œ
ë¸Œë¼ìš°ì €ì—ì„œ:
```
https://stockport-production.up.railway.app/docs
```

---

## ğŸ†˜ ì—¬ì „íˆ ì•ˆ ë˜ë‚˜ìš”?

### 1. ë¡œê·¸ ì „ì²´ ë³µì‚¬
Railway â†’ Deployments â†’ ìµœì‹  ë°°í¬ â†’ View Logs â†’ ì „ì²´ ë³µì‚¬

### 2. í™•ì¸í•  ì˜¤ë¥˜ ë©”ì‹œì§€:

**ë°ì´í„°ë² ì´ìŠ¤ ê´€ë ¨:**
```
could not connect to server
relation "users" does not exist
```

**í•´ê²°:**
- PostgreSQL í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€
- DATABASE_URL í™•ì¸
- ì¬ë°°í¬ (í…Œì´ë¸” ìë™ ìƒì„±)

**í™˜ê²½ë³€ìˆ˜ ê´€ë ¨:**
```
ValidationError
SECRET_KEY
```

**í•´ê²°:**
- SECRET_KEY í™˜ê²½ë³€ìˆ˜ ì„¤ì •
- ëª¨ë“  í•„ìˆ˜ í™˜ê²½ë³€ìˆ˜ í™•ì¸

**í¬íŠ¸ ê´€ë ¨:**
```
Address already in use
```

**í•´ê²°:**
- Start Commandì—ì„œ `$PORT` ì‚¬ìš© í™•ì¸

---

## ğŸ’¡ í”„ë¡œ íŒ

### Railway CLIë¡œ ë¡œê·¸ í™•ì¸:
```bash
npm install -g @railway/cli
railway login
railway logs
```

### ë¡œì»¬ì—ì„œ ë¨¼ì € í…ŒìŠ¤íŠ¸:
```bash
cd backend
export DATABASE_URL="postgresql://..."
export SECRET_KEY="test-secret-key"
uvicorn app.main:app --host 0.0.0.0 --port 8000
```

### ê°„ë‹¨í•œ ë””ë²„ê¹…:
Start Commandë¥¼ ì„ì‹œë¡œ ë³€ê²½:
```bash
python -c "import sys; print(sys.version)"
```
ì´ë ‡ê²Œ í•˜ë©´ Pythonì´ ì„¤ì¹˜ë˜ì—ˆëŠ”ì§€ í™•ì¸ ê°€ëŠ¥

---

## ğŸ¯ ê°€ì¥ í”í•œ ì›ì¸ Top 3

1. **Root Directory ë¯¸ì„¤ì •** (90%)
   â†’ `backend`ë¡œ ì„¤ì •

2. **DATABASE_URL ì—†ìŒ** (80%)
   â†’ PostgreSQL í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€

3. **SECRET_KEY ì—†ìŒ** (70%)
   â†’ í™˜ê²½ë³€ìˆ˜ì— SECRET_KEY ì¶”ê°€

---

## ğŸ“ ì¶”ê°€ ë„ì›€

- Railway ë¬¸ì„œ: https://docs.railway.app
- Railway Discord: https://discord.gg/railway
- í”„ë¡œì íŠ¸ ë¬¸ì„œ: [README.md](README.md)

---

**ê°€ì¥ ì¤‘ìš”í•œ ê²ƒ: ë°°í¬ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”!** ğŸ¯

ë¡œê·¸ì— ì •í™•í•œ ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ ìˆìŠµë‹ˆë‹¤. ë¡œê·¸ë¥¼ í™•ì¸í•˜ê³  ìœ„ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ë”°ë¼í•˜ì„¸ìš”.

